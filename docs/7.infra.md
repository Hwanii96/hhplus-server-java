# INFRA & Structurizr DSL

> 상세 Structurizr DSL은 `(docs/7.서버구조설계-infra_구성도.dsl)` 파일에서 확인한다

## ✅ Structurizr DSL

### 1. System Context (User ↔ System)

```mermaid

graph LR
user[User<br/>콘서트 좌석 예약 및 결제를 수행하는 사용자]
system[Concert Reservation Service<br/>좌석 예약 대기열 + 예약 + 충전 및 결제 서비스]

user -->|HTTPS| system

```


### Container View (서비스 내부 구조)

```mermaid

graph LR
%% 사람
user[User<br/>콘서트 좌석 예약 및 결제를 수행하는 사용자]

%% 시스템 내부 컨테이너들
subgraph CRS[Concert Reservation Service]
web[Web Client<br/>Web / Browser]
api[Concert Reservation Service API<br/>Java / Spring Boot]
worker[Background Worker<br/>비동기 처리 워커]

    redis[(Redis<br/>대기열 캐시 · 좌석 락)]
    mq[(RabbitMQ<br/>메시지 큐)]
    primary[(MySQL Primary<br/>트랜잭션 DB)]
    replica[(MySQL Replica RO<br/>조회용 DB)]
end

%% 관계
user -->|HTTPS| web
web -->|REST API 호출| api

api -->|대기열/좌석 락 상태 조회·갱신| redis
api -->|예약/포인트/결제 트랜잭션| primary
api -->|콘서트/좌석 조회 읽기| replica
api -->|이벤트 생성| mq

worker -->|이벤트 소비| mq
worker -->|예약/대기열 상태 업데이트| primary
worker -->|대기열 캐시/좌석 락 상태 갱신| redis

```


### 3. Deployment View (Production 인프라)

```mermaid

graph LR
%% 클라이언트
client["Users / Web Client"]

%% 인프라 노드들
lb["L7 Load Balancer"]

subgraph APICluster["API Servers"]
api1["API Server #1<br/>Concert Reservation Service API"]
api2["API Server #2<br/>Concert Reservation Service API"]
end

worker["Background Worker Node"]
redis["Redis Node<br/>Redis"]
mq["RabbitMQ Node<br/>RabbitMQ"]
dbPrimary["MySQL Primary Node<br/>MySQL Primary"]
dbReplica["MySQL Replica Node<br/>MySQL Replica"]

%% 트래픽 흐름
client -->|HTTPS| lb
lb --> api1
lb --> api2

api1 -->|트랜잭션| dbPrimary
api2 -->|트랜잭션| dbPrimary

api1 -->|조회| dbReplica
api2 -->|조회| dbReplica

api1 -->|캐시/락 조회·갱신| redis
api2 -->|캐시/락 조회·갱신| redis

api1 -->|이벤트 생성| mq
api2 -->|이벤트 생성| mq

worker -->|이벤트 소비| mq
worker -->|상태 업데이트| dbPrimary
worker -->|캐시/락 갱신| redis

```