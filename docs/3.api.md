# API 명세서 (요약)

> 상세 OpenAPI는 `(docs/3.openapi.yaml)` 파일에서 확인한다

## 📄 Document
- [](docs/2.서버구조설계-API_초안_표_정리.xlsx)

## ✅ API 예시

### 콘서트 예약 날짜 조회 API

| 메서드 | 경로                              | 요청 바디 (필수) | 응답 (핵심)                                                   | 에러                                         | 비고 |
|--------|-----------------------------------|------------------|---------------------------------------------------------------|----------------------------------------------|------|
| GET    | `/concerts/{concertId}/schedules` | 본문 없음        | `scheduleId`, `dateTime`, `isReservable`, `remainingSeats`    | `400 Bad Request`, `404 Not Found`          |      |


### 콘서트 좌석 정보 (목록) 조회 API

| 메서드 | 경로                                                     | 요청 바디 (필수) | 응답 (핵심)                                                                                 | 에러                                         | 비고                                                                                                                                                                                                                |
|--------|----------------------------------------------------------|------------------|---------------------------------------------------------------------------------------------|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GET    | `/concerts/{concertId}/schedules/{scheduleId}/seats`     | 본문 없음        | `seatId`, `seatNumber`, `seatStatus (AVAILABLE / TEMPORARY / RESERVED)`, `seatPrice`       | `400 Bad Request`, `404 Not Found`          | 1) 서버 입장에서 기대한 요청 문법 (형식) 및 스펙이 아닌 경우 `400`을 반환한다 (사실상 모든 API 요청 후 에러가 발생하면 1차적으로 `400` 후보가 된다)<br>2) `concertId` 또는 `scheduleId`가 유효하지 않으면 `404`를 반환한다<br>3) 콘서트와 예약 중인 콘서트를 식별하기 위해서 `scheduleId`가 사용된다고 볼 수 있다 |

### 대기열 토큰 발급 API

| 메서드 | 경로           | 요청 바디 (필수) | 응답 (핵심)                                                                                           | 에러                                     | 비고 |
|--------|----------------|------------------|-------------------------------------------------------------------------------------------------------|------------------------------------------|------|
| POST   | `/queue/tokens` | `scheduleId`     | `queueToken`, `queueStatus (WAITING / ACTIVE / EXPIRED / DONE)`, `position`, `waitingTime`           | `404 Not Found`, `409 Conflict`         | 1) `userId`는 Method Body가 아니라 **Authorization Header**로 들어간다<br>2) `scheduleId`는 Method Body로 들어가야 한다<br>3) `scheduleId`가 존재하지 않는 경우 `404`를 반환한다<br>4) 이미 같은 콘서트에 대기열 토큰이 존재하는 경우 `409`를 반환한다 |


### 대기열 토큰 상태 조회 API

| 메서드 | 경로                          | 요청 바디 (필수) | 응답 (핵심)                                                                                 | 에러                                     | 비고 |
|--------|-------------------------------|------------------|---------------------------------------------------------------------------------------------|------------------------------------------|------|
| GET    | `/queue/tokens/{queueToken}`  | 본문 없음        | `queueStatus (WAITING / ACTIVE / EXPIRED / DONE)`, `position`, `waitingTime`               | `404 Not Found`, `410 Gone`             | 1) 대기열 토큰이 존재하지 않는 경우 `404`를 반환한다<br>2) 대기열 토큰이 만료된 경우 `410`을 반환한다 |


### 좌석 임시 배정 (예약) 요청 API

| 메서드 | 경로            | 요청 바디 (필수)                                                                 | 응답 (핵심)                                                   | 에러                                                                                 | 비고 |
|--------|-----------------|-----------------------------------------------------------------------------------|----------------------------------------------------------------|--------------------------------------------------------------------------------------|------|
| POST   | `/reservations` | `concertId`, `scheduleId`, `seatId`, `userId`, `queueToken`                       | `reservationId`, `seatStatus`, `reservationExpiresAt`         | `401 Unauthorized`, `403 Forbidden`, `404 Not Found`, `409 Conflict`               | 1) 사용자의 `accessToken`이 만료되었거나 등의 경우 `401`을 반환한다<br>2) 대기열 토큰(`queueToken`)의 상태가 `ACTIVE`가 아닌 경우 `403`을 반환한다<br>3) 해당 콘서트 또는 좌석이 존재하지 않는 경우 `404`를 반환한다<br>4) 좌석 임시 배정(예약)을 하려는 좌석이 이미 예약된 경우 `409`를 반환한다 (예: `seatStatus`가 `TEMPORARY` 또는 `RESERVED` 인 경우)<br>5) 요청 바디에 작성된 `userId`는 실제로는 Method Body / Path Variable로 받지 않고, **Authorization Header**에 담긴 `accessToken` 안의 값으로 통일한다 |


### 사용자 포인트 조회 API

| 메서드 | 경로            | 요청 바디 (필수) | 응답 (핵심)          | 에러                                     | 비고 |
|--------|-----------------|------------------|----------------------|------------------------------------------|------|
| GET    | `/points/users` | 본문 없음        | `userCurrentPoints`  | `401 Unauthorized`, `404 Not Found`     | 1) `userId`는 Method Body / Path Variable이 아니라 **Authorization Header**에서 받는다<br>2) 사용자의 `accessToken`이 만료되었거나 등의 경우 `401`을 반환한다<br>3) 해당 사용자가 존재하지 않는 경우 `404`를 반환한다<br><br>※ 정확하게는 `userId`를 포함한 `accessToken`을 Authorization Header로 보내고, 서버는 거기서 `userId`를 추출하는 방식으로 설계한다 |


### 사용자 포인트 조회 API

| 메서드 | 경로            | 요청 바디 (필수) | 응답 (핵심)         | 에러                                     | 비고 |
|--------|-----------------|------------------|---------------------|------------------------------------------|------|
| GET    | `/points/users` | 본문 없음        | `userCurrentPoints` | `401 Unauthorized`, `404 Not Found`     | 1) `userId`는 Method Body 또는 Path Variable로 받지 않고 **Authorization Header**에서 받도록 한다<br>2) 사용자의 `accessToken`이 만료되었거나 등의 경우 `401`을 반환한다<br>3) 해당 사용자가 존재하지 않는 경우 `404`를 반환한다<br><br>※ 정확하게는 `userId` 데이터를 포함시킨 `accessToken`을 Authorization Header로 보내고, 백엔드에서 그 토큰을 파싱해 `userId`를 얻는 방식으로 설계한다 |


### 콘서트 좌석 결제 API

| 메서드 | 경로        | 요청 바디 (필수)                           | 응답 (핵심)                                                               | 에러                                                                                               | 비고 |
|--------|-------------|---------------------------------------------|---------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|------|
| POST   | `/payments` | `userId`, `reservationId`, `queueToken`     | `paymentId`, `seatStatus`, `paidAmount`, `userCurrentPoints`              | `401 Unauthorized`, `403 Forbidden`, `404 Not Found`, `409 Conflict`, `422 Unprocessable Entity` | 1) 사용자의 `accessToken`이 만료되었거나 등의 경우 `401`을 반환한다<br>2) 대기열 토큰(`queueToken`)의 상태가 `ACTIVE`가 아닌 경우 `403`을 반환한다<br>3) 예약 테이블에 해당 예약 건이 없는 경우 `404`를 반환한다<br>4) 결제하려는 좌석의 상태가 이미 `RESERVED` 인 경우 `409`를 반환한다<br>5) 결제 금액보다 사용자의 포인트가 적은 경우 `422`를 반환한다<br>6) 요청 바디에 작성된 `userId`는 실제로는 Method Body / Path Variable이 아니라 **Authorization Header**의 `accessToken` 안에서 가져오도록 통일한다 |
