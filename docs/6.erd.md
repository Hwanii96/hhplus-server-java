# ERD & DBML

> ìƒì„¸ DBMLì€ `(docs/6.dbdiagram.io-DBML.txt)` íŒŒì¼ì—ì„œ í™•ì¸í•œë‹¤

> ## ğŸ“„ Document
    - docs/4.ì„œë²„êµ¬ì¡°ì„¤ê³„-ë°ì´í„°_ëª¨ë¸_ìŠ¤ì¼€ì¹˜_ê°„ì´_ER.xlsx

### âœ… ì²´í¬ ëª©ë¡
   * [ ] API ê¸°ëŠ¥ ëª©ë¡ê³¼ í…Œì´ë¸”ì´ ì¼ì¹˜ë˜ëŠ”ì§€ë¥¼ ì²´í¬ (ì‚¬ìš©ì / ì½˜ì„œíŠ¸ ì¡°íšŒ / ì¢Œì„ ì¡°íšŒ / ì˜ˆì•½ / ì”ì•¡ / ê²°ì œ)
   * [ ] FK / UNIQUE KEY / CONSTRAINT / INDEX ë“±ì„ í†µí•´ ë¬´ê²°ì„± ë° ì„±ëŠ¥ ë³´ì¥
   * [ ] ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ LOCK ì „ëµ (í–¥í›„ ì²´í¬ í•„ìš”)
   * [ ] íŠ¸ëœì­ì…˜ ROLLBACK ê³„íš

### âœ… í•µì‹¬ ëª¨ë¸ë§ ì›ì¹™
    - 1. ëŒ€ê¸°ì—´ í† í°ì€ ì½˜ì„œíŠ¸ ì „ì²´ ê³µìš© í† í°ì´ ì•„ë‹ˆë¼ íŠ¹ì • ì˜ˆì•½ ì¼ì • (íšŒì°¨ / ìŠ¤ì¼€ì¤„) ê¸°ì¤€ìœ¼ë¡œ ë°œê¸‰ ë° ì‚¬ìš©ëœë‹¤ (1:N)
    - 2. íŠ¹ì • ì½˜ì„œíŠ¸ì˜ ì˜ˆì•½ ì¼ì • ì¤‘ì— ì¡´ì¬í•˜ëŠ” ì¢Œì„ì˜ ë²ˆí˜¸ëŠ” ë‹¹ì—°íˆ ì¤‘ë³µë  ìˆ˜ ì—†ë‹¤
    - 3. í•˜ë‚˜ì˜ ì¢Œì„ì€ ì‹œê°„ì˜ íë¦„ì— ë”°ë¼ ì—¬ëŸ¬ ë²ˆ ì˜ˆì•½ ì‹œë„ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤ (1:N) 
    - 4. ìƒì„± ì»¬ëŸ¼ê³¼ ë³µí•© ìœ ë‹ˆí¬ í‚¤ë¥¼ ì¡°í•©í•˜ì—¬ ì¢Œì„ ì˜ˆì•½ ì‹œ ë™ì‹œì„± ë¬¸ì œë¥¼ ë°©ì–´í•œë‹¤
    - 5. ì˜ˆì•½ / í¬ì¸íŠ¸ / ê²°ì œëŠ” ì´ë ¥ í…Œì´ë¸”ì„ ìƒì„±í•˜ì—¬ ë¡œê·¸, ì´ë ¥, ëª¨ë‹ˆí„°ë§, ê°ì‚¬ ë“±ì— ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤
    - 6. ê²°ì œ ì‹œ ëª¨ë“  íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œëœ ì´í›„ì—ë§Œ ê²°ì œ rowê°€ ìƒì„±ë˜ë„ë¡ í•œë‹¤ (ê²°ì œ ì‹œë„ ì‹œ ë°”ë¡œ INITIATED ìƒíƒœë¡œ rowë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆì§€ë§Œ)
    - 7. ê²°ì œ ì‹œ ì›ìì„±ì„ ìœ„í•´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì— ê´€ë ¨ëœ í…Œì´ë¸”ì„ ëª¨ë‘ ë™ì‹œ ì»¤ë°‹í•˜ë„ë¡ í•œë‹¤
    - 8.

### âœ… ë„ë©”ì¸
    - 1. ì‚¬ìš©ì (users) : ì¸ì¦, ì¸ê°€ 
    - 2. ì½˜ì„œíŠ¸ ì •ë³´ (concerts) : ì½˜ì„œíŠ¸ ë©”íƒ€ ë°ì´í„°
    - 3. ì½˜ì„œíŠ¸ ì˜ˆì•½ ì¼ì • (concerts_schedules) : ì˜ˆì•½ ê°€ëŠ¥í•œ ì½˜ì„œíŠ¸ ì¼ì • ì •ë³´
    - 4. ì½˜ì„œíŠ¸ ì˜ˆì•½ ì¼ì • ë³„ ì¢Œì„ (concerts_schedules_seats) : ì¼ì • ë³„ ì¢Œì„ ì •ë³´
    - 5. ëŒ€ê¸°ì—´ í† í° (queue_tokens) : í† í° ë°œê¸‰, ì—…ë°ì´íŠ¸, ë§Œë£Œ
    - 6. ì˜ˆì•½ (seats_reservations) : ì¢Œì„ ì˜ˆì•½ ìƒíƒœ ì—…ë°ì´íŠ¸ (TEMPORARY, RESERVED, EXPIRED)
    - 7. ì˜ˆì•½ ì´ë ¥ (seats_reservations_histories) : ì˜ˆì•½ ì´ë ¥ ìƒíƒœ (TEMPORARY, RESERVED, EXPIRED)
    - 8. ì‚¬ìš©ì í¬ì¸íŠ¸ (users_points) : ì‚¬ìš©ì í¬ì¸íŠ¸ í˜„í™© ì •ë³´
    - 9. ì‚¬ìš©ì í¬ì¸íŠ¸ ì´ë ¥ (users_points_histories) : í¬ì¸íŠ¸ ì´ë ¥ (CHARGE, USE)
    - 10. ê²°ì œ (seats_payments) : ê²°ì œ ì •ë³´ (SUCCESS, FAILED)
    - 11. ê²°ì œ ì´ë ¥ (seats_payments_histories) : ê²°ì œ ì´ë ¥ (SUCCESS, FAILED)

### âœ… ì—”í„°í‹°
    - 1. User
    - 2. Concert
    - 3. Schedule
    - 4. Seat
    - 5. QueueToken
    - 6. Reservation
    - 7. ReservationHistory
    - 8. Point
    - 9. PointHistory
    - 10. Payment
    - 11. PaymentHistory

### âœ… ì •ì±…
    - 1. ëŒ€ê¸°ì—´ í† í° ë°œê¸‰ ì‹œ í† í° ìœ íš¨ ì‹œê°„ : ê¸°ë³¸ 10ë¶„ (í…ŒìŠ¤íŠ¸ í™˜ê²½ ì‹œ ë¯¸ì •)
    - 2. ëŒ€ê¸°ì—´ í† í°ì˜ ìƒíƒœê°€ ACTIVE (í™œì„±) ê°€ ë˜ëŠ” ì¡°ê±´ ì„¤ì • (ì˜ˆ : nì´ˆ ë§ˆë‹¤ ë°°ì¹˜ë¥¼ í†µí•´ ìŠ¹ê²©, .. ë“±)
    - 3. ëŒ€ê¸°ì—´ í† í° ë°œê¸‰ ê°œìˆ˜ ì œí•œ (ì˜ˆ : ë™ì‹œ í™œì„± ì‚¬ìš©ì ìˆ˜ ì œí•œ, .. ë“±)
    - 4.

### âœ… ë„ë©”ì¸ ë³„ ì—”í„°í‹° ìƒì„¸ í•„ë“œ

#### ğŸ¥¸ ì‚¬ìš©ì ë„ë©”ì¸ (users)

users

| Column       | Type          | Nullable   | Description                    |
|--------------|---------------|------------|--------------------------------|
| `id`         | BIGINT        | NOT NULL   | PK, ì‚¬ìš©ì ID (UID)               |
| `email`      | VARCHAR(255)  | NOT NULL   | ë¡œê·¸ì¸ìš© ì´ë©”ì¼, UNIQUE               |
| `password`   | VARCHAR(255)  | NOT NULL   | ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸                      |
| `name`       | VARCHAR(100)  | NULL       | ì‚¬ìš©ì ì´ë¦„                         |
| `status`     | VARCHAR(20)   | NOT NULL   | ê³„ì • ìƒíƒœ (ACTIVE, INACTIVE, .. ë“±) |
| `createdAt`  | DATETIME      | NOT NULL   | ê³„ì • ìƒì„± ì‹œê°                       |
| `updatedAt`  | DATETIME      | NOT NULL   | ê³„ì • ìˆ˜ì • ì‹œê°                       |


#### ğŸª™ ëŒ€ê¸°ì—´ ë„ë©”ì¸ (queue_tokens)

queue_tokens

| Column        | Type                                       | Nullable  | Description                  |
|---------------|--------------------------------------------|-----------|------------------------------|
| `id`          | BIGINT                                     | NOT NULL  | PK                           |
| `token`       | VARCHAR(100)                               | NOT NULL  | ëŒ€ê¸°ì—´ í† í° ë¬¸ìì—´, UNIQUE           |
| `userId`      | BIGINT                                     | NOT NULL  | FK â†’ `users.id`              |
| `scheduleId`  | BIGINT                                     | NOT NULL  | FK â†’ `concerts_schedules.id` |
| `tokenStatus` | ENUM('WAITING','ACTIVE','DONE','EXPIRED')  | NOT NULL  | ëŒ€ê¸° ìƒíƒœ                        |
| `position`    | INT                                        | NULL      | í˜„ì¬ ëŒ€ê¸° ìˆœë²ˆ                     |
| `waitingTime` | INT                                        | NULL      | ì˜ˆìƒ ëŒ€ê¸° ì‹œê°„(ì´ˆ ë“±)                |
| `activatedAt` | DATETIME                                   | NULL      | ëŒ€ê¸°ì—´ í† í°ì´ í™œì„±í™”ëœ ì‹œê°              |
| `expiredAt`   | DATETIME                                   | NULL      | í† í° ë§Œë£Œ ì‹œê°                     |
| `createdAt`   | DATETIME                                   | NOT NULL  | ìƒì„± ì‹œê°                        |
| `updatedAt`   | DATETIME                                   | NOT NULL  | ìˆ˜ì • ì‹œê°                        |


#### ğŸµ ì½˜ì„œíŠ¸ ë„ë©”ì¸ (concerts / concerts_schedules / concerts_schedules_seats)

concerts

| Column        | Type         | Nullable | Description   |
|---------------|--------------|----------|---------------|
| `id`          | BIGINT       | NOT NULL | PK, concertId |
| `title`       | VARCHAR(255) | NOT NULL | ì½˜ì„œíŠ¸ ì´ë¦„        |
| `description` | TEXT         | NULL     | ì½˜ì„œíŠ¸ ì„¤ëª…        |
| `createdAt`   | DATETIME     | NOT NULL | ì½˜ì„œíŠ¸ ì •ë³´ ìƒì„± ì‹œê°  |
| `updatedAt`   | DATETIME     | NOT NULL | ì½˜ì„œíŠ¸ ì •ë³´ ìˆ˜ì • ì‹œê°  |

concerts_schedules

| Column           | Type      | Nullable | Description           |
|------------------|-----------|----------|-----------------------|
| `id`             | BIGINT    | NOT NULL | PK, scheduleId        |
| `concertId`      | BIGINT    | NOT NULL | FK â†’ `concerts.id`    |
| `startAt`        | DATETIME  | NOT NULL | ì¼ì • (ìŠ¤ì¼€ì¤„) ì¼ì‹œ           |
| `isReservable`   | TINYINT(1) | NOT NULL | ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ (true/false) |
| `createdAt`      | DATETIME  | NOT NULL | ìŠ¤ì¼€ì¤„ ìƒì„± ì‹œê°             |
| `updatedAt`      | DATETIME  | NOT NULL | ìŠ¤ì¼€ì¤„ ìˆ˜ì • ì‹œê°             |

concerts_schedules_seats

| Column       | Type                                         | Nullable | Description                  |
|--------------|----------------------------------------------|----------|------------------------------|
| `id`         | BIGINT                                       | NOT NULL | PK, seatId                   |
| `scheduleId` | BIGINT                                       | NOT NULL | FK â†’ `concerts_schedules.id` |
| `seatNumber` | VARCHAR(20)                                  | NOT NULL | ì¢Œì„ ë²ˆí˜¸ (ì˜ˆ: A-10)              |
| `seatPrice`  | INT                                          | NOT NULL | ì¢Œì„ ê°€ê²©                        |
| `seatStatus` | ENUM (AVAILABLE, TEMPORARY, RESERVED)        | NOT NULL | ì¢Œì„ ìƒíƒœ                        |
| `createdAt`  | DATETIME                                     | NOT NULL | ë ˆì½”ë“œ ìƒì„± ì‹œê°                    |
| `updatedAt`  | DATETIME                                     | NOT NULL | ë ˆì½”ë“œ ìˆ˜ì • ì‹œê°                    |


#### ğŸ“ ì˜ˆì•½ ë„ë©”ì¸ (seats_reservations / seats_reservations_histories)

seats_reservations

| Column                     | Type                                               | Nullable   | Description                            |
|----------------------------|----------------------------------------------------|------------|----------------------------------------|
| `id`                       | BIGINT                                             | NOT NULL   | PK, reservationId                      |
| `userId`                   | BIGINT                                             | NOT NULL   | FK â†’ `users.id`                        |
| `scheduleId`               | BIGINT                                             | NOT NULL   | FK -> `concerts_schedules.id`          |              
| `seatId`                   | BIGINT                                             | NOT NULL   | FK â†’ `concerts_schedules_seats.id`     |
| `reservationStatus`        | ENUM('TEMPORARY','RESERVED','CANCELLED','EXPIRED') | NOT NULL   | ì˜ˆì•½ ìƒíƒœ                                  |
| `reservationExpiresAt`     | DATETIME                                           | NULL       | ì„ì‹œ ë°°ì • ë§Œë£Œ ì‹œê° (TEMPORARYì¼ ë•Œë§Œ)            |
| `createdAt`                | DATETIME                                           | NOT NULL   | ì˜ˆì•½ ìƒì„± ì‹œê°                               |
| `updatedAt`                | DATETIME                                           | NOT NULL   | ì˜ˆì•½ ìˆ˜ì • ì‹œê°                               |
| `isActive`                 | TINYINT                                            | NULL       | ì¢Œì„ ì„ì‹œ ë°°ì • (ì˜ˆì•½) ì‹œ ë™ì‹œì„± ë¬¸ì œ ì²˜ë¦¬ ë“±ì„ ìœ„í•´ ìƒì„±ëœ ì¹¼ëŸ¼ |

seats_reservations_histories

| Column              | Type                                               | Nullable | Description                  |
|---------------------|----------------------------------------------------|----------|------------------------------|
| `id`                | BIGINT                                             | NOT NULL | PK, ì´ë ¥ ID                    |
| `reservationId`     | BIGINT                                             | NOT NULL | FK â†’ `seats_reservations.id` |
| `reservationStatus` | ENUM('TEMPORARY','RESERVED','CANCELLED','EXPIRED') | NOT NULL | ë³€ê²½ëœ ì˜ˆì•½ ìƒíƒœ                    |
| `expireAt`          | DATETIME                                           | NULL     | ì˜ˆì•½ ë§Œë£Œ ì‹œê°                     |
| `description`       | TEXT                                               | NULL     | ìƒíƒœ ë³€ê²½ ì‚¬ìœ                      |
| `createdAt`         | DATETIME                                           | NOT NULL | ì´ë ¥ ìƒì„± ì‹œê°                     |

#### ğŸ’¸ í¬ì¸íŠ¸ ë„ë©”ì¸ (users_points / users_points_histories)

users_points

| Column      | Type     | Nullable  | Description            |
|-------------|----------|-----------|------------------------|
| `userId`    | BIGINT   | NOT NULL  | PK & FK â†’ `users.id`   |
| `point`     | INT      | NOT NULL  | í˜„ì¬ í¬ì¸íŠ¸ ì”ì•¡              |
| `updatedAt` | DATETIME | NOT NULL  | ì”ì•¡ ë§ˆì§€ë§‰ ë³€ê²½ ì‹œê°           |

users_points_histories

| Column        | Type                          | Nullable | Description                                                  |
|---------------|-------------------------------|----------|--------------------------------------------------------------|
| `id`          | BIGINT                        | NOT NULL | PK, `users_points_histories_id`                              |
| `userId`      | BIGINT                        | NOT NULL | FK, `users.id`                                               |
| `type`        | ENUM('CHARGE','USE','REFUND') | NOT NULL | í¬ì¸íŠ¸ ì´ë ¥ íƒ€ì… (REFUNDëŠ” í™•ì¥ ê³ ë ¤ìš©, í˜„ì¬ ë¡œì§ ë¯¸êµ¬í˜„ ê°€ëŠ¥)                     |
| `amount`      | INT                           | NOT NULL | í¬ì¸íŠ¸ ì¦ê°ëŸ‰ (í•­ìƒ ì–‘ìˆ˜, type=USE, amount=5000 ì¸ ê²½ìš°, 5000 í¬ì¸íŠ¸ ì‚¬ìš©ì„ ì˜ë¯¸) |
| `afterPoint`  | INT                           | NOT NULL | í•´ë‹¹ íŠ¸ëœì­ì…˜ ì´í›„ í¬ì¸íŠ¸ ì”ì•¡                                            |
| `name`        | VARCHAR(255)                  | NULL     | ì´ë ¥ ì´ë¦„ (ì˜ˆ: í¬ì¸íŠ¸ ì¹´ë“œ ì¶©ì „, ë¬´í†µì¥ ì…ê¸ˆ, ì½˜ì„œíŠ¸ ê²°ì œ ë“±)                       |
| `description` | TEXT                          | NULL     | ì´ë ¥ ìƒì„¸ ì„¤ëª…                                                     |
| `paymentId`   | BIGINT                        | NULL     | FK, `seats_payments.id` (ì½˜ì„œíŠ¸ ê²°ì œì™€ ì—°ê²°ëœ ê²½ìš°ì—ë§Œ ì˜ë¯¸ ìˆìŒ)             |
| `createdAt`   | DATETIME                      | NOT NULL | í¬ì¸íŠ¸ ì´ë ¥ ë ˆì½”ë“œ ìƒì„± ì‹œê°                                             |


#### ğŸ¤‘ ê²°ì œ ë„ë©”ì¸ (seats_payments / seats_payments_histories)

seats_payments

| Column          | Type                                 | Nullable | Description                   |
|-----------------|--------------------------------------|----------|-------------------------------|
| `id`            | BIGINT                               | NOT NULL | PK, paymentId                 |
| `reservationId` | BIGINT                               | NOT NULL | FK â†’ `seats_reservations.id`  |
| `userId`        | BIGINT                               | NOT NULL | FK â†’ `users.id`               |
| `amount`        | INT                                  | NOT NULL | ê²°ì œ ê¸ˆì•¡                         |
| `paymentStatus` | ENUM('SUCCESS','FAILED','CANCELLED') | NOT NULL | ê²°ì œ ìƒíƒœ                         |
| `paidAt`        | DATETIME                             | NULL     | ì‹¤ì œ ê²°ì œ ì™„ë£Œ ì‹œê° (`SUCCESS`ì¼ ë•Œ ì‚¬ìš©) |
| `createdAt`     | DATETIME                             | NOT NULL | ê²°ì œ ë ˆì½”ë“œ ìƒì„± ì‹œê°                  |
| `updatedAt`     | DATETIME                             | NOT NULL | ê²°ì œ ë ˆì½”ë“œ ìˆ˜ì • ì‹œê°                  |

seats_payments_histories

| Column          | Type                                 | Nullable | Description              |
|-----------------|--------------------------------------|----------|--------------------------|
| `id`            | BIGINT                               | NOT NULL | PK, ê²°ì œ ì´ë ¥ ID             |
| `paymentId`     | BIGINT                               | NOT NULL | FK â†’ `seats_payments.id` |
| `paymentStatus` | ENUM('SUCCESS','FAILED','CANCELLED') | NOT NULL | ë³€ê²½ëœ ê²°ì œ ìƒíƒœ                |
| `description`   | VARCHAR(255)                         | NULL     | ìƒíƒœ ë³€ê²½ ì´ìœ                  |
| `createdAt`     | DATETIME                             | NOT NULL | ì´ë ¥ ìƒì„± ì‹œê°                 |


### âœ… ERD (Mermaid)

```mermaid
erDiagram

    USERS {
        bigint id
        varchar email
        varchar password
        varchar name
        varchar status
        datetime createdAt
        datetime updatedAt
    }

    CONCERTS {
        bigint id
        varchar title
        text description
        datetime createdAt
        datetime updatedAt
    }

    CONCERTS_SCHEDULES {
        bigint id
        bigint concertId
        datetime startAt
        boolean isReservable
        datetime createdAt
        datetime updatedAt
    }

    CONCERTS_SCHEDULES_SEATS {
        bigint id
        bigint scheduleId
        varchar seatNumber
        int seatPrice
        string seatStatus
        datetime createdAt
        datetime updatedAt
    }

    QUEUE_TOKENS {
        bigint id
        varchar token
        bigint userId
        bigint scheduleId
        string tokenStatus
        int position
        int waitingTime
        datetime activatedAt
        datetime expiredAt
        datetime createdAt
        datetime updatedAt
    }

    SEATS_RESERVATIONS {
        bigint id
        bigint userId
        bigint scheduleId
        bigint seatId
        string reservationStatus
        datetime reservationExpiresAt
        tinyint isActive
        datetime createdAt
        datetime updatedAt
    }

    SEATS_RESERVATIONS_HISTORIES {
        bigint id
        bigint reservationId
        string status
        datetime expiresAt
        varchar description
        datetime createdAt
    }

    USERS_POINTS {
        bigint userId
        int point
        datetime updatedAt
    }

    USERS_POINTS_HISTORIES {
        bigint id
        bigint userId
        string type
        int amount
        int afterPoint
        varchar name
        text description
        bigint paymentId
        datetime createdAt
    }

    SEATS_PAYMENTS {
        bigint id
        bigint reservationId
        bigint userId
        int amount
        string status
        datetime paidAt
        datetime createdAt
        datetime updatedAt
    }

    SEATS_PAYMENTS_HISTORIES {
        bigint id
        bigint paymentId
        string paymentStatus
        varchar description
        datetime createdAt
    }

    %% -------------------------
    %% Relationships
    %% -------------------------

    USERS ||--o{ QUEUE_TOKENS : ""
    USERS ||--|| USERS_POINTS : ""
    USERS ||--o{ USERS_POINTS_HISTORIES : ""
    USERS ||--o{ SEATS_RESERVATIONS : ""
    USERS ||--o{ SEATS_PAYMENTS : ""

    CONCERTS ||--o{ CONCERTS_SCHEDULES : ""

    CONCERTS_SCHEDULES ||--o{ CONCERTS_SCHEDULES_SEATS : ""
    CONCERTS_SCHEDULES ||--o{ QUEUE_TOKENS : ""
    CONCERTS_SCHEDULES ||--o{ SEATS_RESERVATIONS : ""

    CONCERTS_SCHEDULES_SEATS ||--o{ SEATS_RESERVATIONS : ""

    SEATS_RESERVATIONS ||--o{ SEATS_RESERVATIONS_HISTORIES : ""
    SEATS_RESERVATIONS ||--o{ SEATS_PAYMENTS : ""

    SEATS_PAYMENTS ||--o{ SEATS_PAYMENTS_HISTORIES : ""
    SEATS_PAYMENTS ||--o{ USERS_POINTS_HISTORIES : ""